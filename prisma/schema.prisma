generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id            String   @id @default(uuid())
  username      String   @unique
  name          String
  email         String   @unique
  phone_number  String   @unique
  password_hash String
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  companies Company[]
  orders    Order[]

  @@map("users")
}

model employee {
  id           String   @id @default(uuid())
  first_name   String
  last_name    String
  email        String   @unique
  phone_number String   @unique
  hire_date    DateTime
  job_title    String
  salary       Float
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  @@unique([first_name, last_name])
  @@map("employees")
}

model Role {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  created_at  DateTime @default(now())

  @@map("roles")
}

model Municipality {
  id         String   @id @default(uuid())
  name       String   @unique
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  province_id String
  province    Province   @relation(fields: [province_id], references: [id])
  companies   Company[]
  suppliers   Supplier[]
  costumers   Costumer[]

  @@map("municipalities")
}

model Province {
  id             String         @id @default(uuid())
  name           String         @unique
  created_at     DateTime       @default(now())
  updated_at     DateTime       @updatedAt
  municipalities Municipality[]

  @@map("provinces")
}

model Company {
  id                  String   @id @default(uuid())
  name                String   @unique
  created_at          DateTime @default(now())
  nif                 String   @unique
  social_reason       String
  registration_number String   @unique
  email               String   @unique
  website             String?
  updated_at          DateTime @updatedAt
  regime              Regime   @default(SIMPLIFICADO)
  user_owner_id       String
  userOwner           User     @relation(fields: [user_owner_id], references: [id])

  document_code String @unique

  social_capital Float @default(0)

  street          String
  zip_code        String?
  municipality_id String
  municipality    Municipality @relation(fields: [municipality_id], references: [id])

  phone_number String @unique

  @@map("companies")
}

enum Regime {
  SIMPLIFICADO
  EXCLUSAO
  GERAL
}

model Product {
  id            String          @id @default(uuid())
  name          String
  description   String?
  price         Float
  category_id   String
  category      ProductCategory @relation(fields: [category_id], references: [id])
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt
  stocks        Stock[]
  productOrders ProductOrder[]

  @@map("products")
}

model Stock {
  id         String   @id @default(uuid())
  product_id String
  quantity   Int
  location   String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  supplier Supplier? @relation(fields: [supplier_id], references: [id])

  product     Product @relation(fields: [product_id], references: [id])
  supplier_id String?

  @@unique([product_id, location])
  @@map("stocks")
}

model ProductCategory {
  id         String    @id @default(uuid())
  name       String    @unique
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  products   Product[]

  @@map("product_categories")
}

model Costumer {
  id            String       @id @default(uuid())
  first_name    String?
  last_name     String?      @default("Consumidor Final")
  nif           String       @unique
  costumer_type CostumerType
  email         String?      @unique
  phone_number  String?      @unique
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt

  street          String?
  zip_code        String?
  municipality_id String
  municipality    Municipality @relation(fields: [municipality_id], references: [id])

  @@unique([first_name, last_name])
  @@map("costumers")
}

enum CostumerType {
  INDIVIDUAL
  COMPANY
}

model ProductOrder {
  id         String   @id @default(uuid())
  order_id   String
  product_id String
  quantity   Int
  unit_price Float
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  order   Order   @relation(fields: [order_id], references: [id])
  product Product @relation(fields: [product_id], references: [id])

  @@unique([order_id, product_id])
  @@map("product_orders")
}

model Order {
  id            String         @id @default(uuid())
  order_date    DateTime       @default(now())
  customer_id   String
  created_at    DateTime       @default(now())
  updated_at    DateTime       @updatedAt
  customer      User           @relation(fields: [customer_id], references: [id])
  productOrders ProductOrder[]

  @@map("orders")
}

model Supplier {
  id   String @id @default(uuid())
  name String
  nif  String @unique

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  stocks     Stock[]

  street          String
  zip_code        String?
  municipality_id String
  municipality    Municipality @relation(fields: [municipality_id], references: [id])

  @@map("suppliers")
}
